---
phase: 07-quality-polish
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - components/ConfigDialog.jsx
  - components/TimerOverlay.jsx
  - components/ConsistencyPicker.jsx
  - components/EggInputs.jsx
  - components/SettingsPanel.jsx
  - components/LocationPressure.jsx
  - components/ResultDisplay.jsx
  - egg-calculator.jsx
autonomous: true

must_haves:
  truths:
    - "Every button shows a visible focus ring when navigated to via Tab key"
    - "Focus rings do NOT appear on mouse click (only keyboard)"
    - "User can Tab through all interactive elements without getting trapped"
    - "User can Escape out of ConfigDialog and TimerOverlay via keyboard"
    - "Select element and number input retain their existing focus styles"
  artifacts:
    - path: "components/ConfigDialog.jsx"
      provides: "focus-visible indicators on close button, unit toggles, language buttons"
      contains: "focus-visible:ring"
    - path: "components/TimerOverlay.jsx"
      provides: "focus-visible indicators on pause/resume, stop, dismiss buttons"
      contains: "focus-visible:ring"
    - path: "components/ConsistencyPicker.jsx"
      provides: "focus-visible indicators on 4 consistency buttons"
      contains: "focus-visible:ring"
    - path: "components/EggInputs.jsx"
      provides: "focus-visible indicators on egg count, egg size, start temp buttons"
      contains: "focus-visible:ring"
    - path: "components/SettingsPanel.jsx"
      provides: "focus-visible indicators on stove type buttons and reset button"
      contains: "focus-visible:ring"
    - path: "components/LocationPressure.jsx"
      provides: "focus-visible indicators on GPS button"
      contains: "focus-visible:ring"
    - path: "components/ResultDisplay.jsx"
      provides: "focus-visible indicators on timer start/stop button"
      contains: "focus-visible:ring"
    - path: "egg-calculator.jsx"
      provides: "focus-visible indicators on cogwheel, settings toggle, energy toggle, formulas toggle"
      contains: "focus-visible:ring"
  key_links:
    - from: "all button elements"
      to: "Tailwind focus-visible variant"
      via: "CSS class"
      pattern: "focus-visible:ring-2"
    - from: "egg-calculator.jsx escape handler"
      to: "ConfigDialog + TimerOverlay"
      via: "existing useEffect keydown listener"
      pattern: "e\\.key === 'Escape'"
---

<objective>
Add keyboard-only focus indicators (focus-visible:ring) to every interactive element across all components, and verify existing escape key handling works for both ConfigDialog and TimerOverlay.

Purpose: Make the app navigable via keyboard with visible focus state on all buttons, completing WCAG keyboard accessibility requirements.
Output: All 7 component files and egg-calculator.jsx updated with focus-visible classes on every button.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-quality-polish/07-RESEARCH.md

@egg-calculator.jsx
@components/ConfigDialog.jsx
@components/TimerOverlay.jsx
@components/ConsistencyPicker.jsx
@components/EggInputs.jsx
@components/SettingsPanel.jsx
@components/LocationPressure.jsx
@components/ResultDisplay.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add focus-visible indicators to all buttons in all components</name>
  <files>
    components/ConfigDialog.jsx
    components/TimerOverlay.jsx
    components/ConsistencyPicker.jsx
    components/EggInputs.jsx
    components/SettingsPanel.jsx
    components/LocationPressure.jsx
    components/ResultDisplay.jsx
    egg-calculator.jsx
  </files>
  <action>
    Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2` to EVERY button element across the codebase. Use component-appropriate ring colors:

    **Ring color per component context:**
    - Amber-themed buttons (most buttons): `focus-visible:ring-amber-500`
    - Sky-themed buttons (LocationPressure GPS): `focus-visible:ring-sky-500`
    - Red buttons (TimerOverlay stop): `focus-visible:ring-red-500`
    - Green buttons (TimerOverlay resume): `focus-visible:ring-green-500`
    - Gray buttons (SettingsPanel reset, TimerOverlay pause): `focus-visible:ring-gray-500`

    **Specific elements per file:**

    **egg-calculator.jsx** (4 buttons):
    1. Cogwheel button (line 186): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2`
    2. Settings toggle button (line 224): Add same amber focus ring
    3. Energy toggle button (line 321): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500`  (no offset — text-only button)
    4. Formulas toggle button (line 344): Add same as energy toggle

    **ConfigDialog.jsx** (12 buttons):
    1. Close button (line 79-84): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 focus-visible:ring-offset-2`
    2. Temp unit toggle (line 90-97): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2`
    3. Volume unit toggle (line 103-110): Same as temp
    4. Weight unit toggle (line 116-123): Same as temp
    5. Pressure unit toggle (line 129-136): Same as temp
    6. Language buttons (6 in map, line 144-155): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2`

    **TimerOverlay.jsx** (3 buttons):
    1. Dismiss button (line 51-56): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2`
    2. Pause/Resume button (line 69-78): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2` with conditional ring color matching bg: `${timerPaused ? 'focus-visible:ring-green-500' : 'focus-visible:ring-gray-500'}`
    3. Stop button (line 81-85): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2`

    **ConsistencyPicker.jsx** (4 buttons):
    - All consistency buttons (line 25-37): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2`

    **EggInputs.jsx** (~15 buttons):
    - Egg count buttons (line 49-60): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2`
    - Egg size buttons (line 87-99): Same
    - Start temp buttons (line 118-133): Same

    **SettingsPanel.jsx** (6+ buttons):
    - Stove type buttons (line 57-70): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2`
    - Reset button (line 187-197): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 focus-visible:ring-offset-2`

    **LocationPressure.jsx** (1 button):
    - GPS button (line 46-52): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2`

    **ResultDisplay.jsx** (1 button):
    - Timer start/stop button (line 95-101): Add `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2`

    **For existing focus-styled inputs — leave as-is:**
    - LocationPressure pressure input already has `focus:outline-none focus:ring-2 focus:ring-sky-400` — do NOT change (it's a text input, focus: is correct)
    - SettingsPanel pot material select already has `focus:outline-none focus:ring-2 focus:ring-amber-400` — do NOT change

    **For range inputs — do NOT add focus styles.** Range inputs have browser-native focus indicators and adding ring-offset looks awkward on sliders.

    **Important:** Append the focus-visible classes to the END of existing className strings. Do not rearrange or remove any existing classes.
  </action>
  <verify>
    1. `npm run build` succeeds
    2. Count focus-visible occurrences across all files:
       `grep -r "focus-visible:ring" components/ egg-calculator.jsx | wc -l` should be >= 30 (every button has it)
    3. `grep -r "focus-visible:ring" components/ConfigDialog.jsx | wc -l` >= 6 (close + 4 units + language map)
    4. `grep -r "focus-visible:ring" components/TimerOverlay.jsx | wc -l` >= 3
    5. Existing `focus:ring` on LocationPressure input and SettingsPanel select are unchanged:
       `grep "focus:ring-2 focus:ring-sky-400" components/LocationPressure.jsx` still exists
       `grep "focus:ring-2 focus:ring-amber-400" components/SettingsPanel.jsx` still exists
  </verify>
  <done>
    - Every button across all 8 files has focus-visible:ring-2 with appropriate color
    - Focus rings only appear on keyboard navigation (focus-visible), not on mouse click
    - Existing focus styles on input and select elements are preserved unchanged
    - Range inputs have no added focus styles (browser defaults are sufficient)
    - Build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify and document escape key + tab order behavior</name>
  <files>egg-calculator.jsx</files>
  <action>
    The escape key handler already exists in egg-calculator.jsx (lines 117-139). It handles:
    - timerActive → stopTimer()
    - timerComplete → dismissComplete()
    - showConfigDialog → setShowConfigDialog(false)

    Verify this handler is correct by reading it. If it covers all three cases above, NO CODE CHANGES are needed for escape handling.

    For tab order: The app uses natural DOM order with no positive tabindex values. This is correct behavior. Verify by grepping for tabindex in the codebase — there should be none (or only tabindex="-1" or tabindex="0").

    Run verification:
    ```bash
    grep -r "tabIndex\|tabindex" components/ egg-calculator.jsx main.jsx
    ```

    If any positive tabindex values are found, remove them. If none found, no changes needed.

    The only code change in this task (if needed): If the escape handler is missing the `timerPaused` case or has stale dependencies, fix them. Based on current code review, the handler looks correct — it has `[showConfigDialog, timerActive, timerComplete, stopTimer, dismissComplete]` as dependencies.

    This is primarily a verification task to confirm QUAL-03 requirements are met:
    - Escape closes ConfigDialog: YES (line 132-134)
    - Escape stops active timer: YES (line 122-125)
    - Escape dismisses complete timer: YES (line 127-129)
    - No keyboard traps: YES (no focus trapping implemented, natural DOM flow)
    - Correct tab order: YES (no positive tabindex values)
  </action>
  <verify>
    1. `grep -r "tabIndex\|tabindex" components/ egg-calculator.jsx main.jsx` returns no positive values
    2. `grep "e.key === 'Escape'" egg-calculator.jsx` confirms handler exists
    3. `npm run build` succeeds
    4. `npm test` passes
  </verify>
  <done>
    - Escape key handler confirmed working for ConfigDialog, active timer, and complete timer
    - No keyboard traps exist (no focus trapping, no positive tabindex)
    - Tab order follows natural DOM order
    - No code changes needed unless verification finds issues
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes without errors
2. `npm test` passes (existing tests unaffected)
3. Every button element has focus-visible:ring-2 in its className
4. Existing focus styles on input/select elements are preserved
5. Escape key handler covers all 3 dismiss cases
6. No positive tabindex values anywhere in the codebase
7. No keyboard traps (ConfigDialog and TimerOverlay dismissible via Escape)
</verification>

<success_criteria>
- All buttons show visible focus ring when Tab-navigated to
- Focus rings do NOT appear on mouse click (focus-visible, not focus)
- Escape closes ConfigDialog when open
- Escape stops TimerOverlay when active
- Escape dismisses TimerOverlay when complete
- No keyboard traps — user can always Tab away or Escape
- Tab order follows natural DOM reading order
- Existing input/select focus styles unchanged
- Build and all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-quality-polish/07-02-SUMMARY.md`
</output>
