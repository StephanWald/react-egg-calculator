---
phase: 03-utilities-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - constants.js
  - converters.js
  - test/constants.test.js
  - test/converters.test.js
autonomous: true

must_haves:
  truths:
    - "Constants importable from constants.js with no React dependency"
    - "Unit converters importable from converters.js with no React dependency"
    - "All constant arrays are frozen (Object.freeze) to prevent mutation"
    - "Converter functions produce identical output to inline component math"
  artifacts:
    - path: "constants.js"
      provides: "5 frozen constant arrays (STOVE_TYPES, POT_MATERIALS, CONSISTENCY_OPTIONS, EGG_SIZES, START_TEMP_OPTIONS)"
      exports: ["STOVE_TYPES", "POT_MATERIALS", "CONSISTENCY_OPTIONS", "EGG_SIZES", "START_TEMP_OPTIONS"]
    - path: "converters.js"
      provides: "4 unit conversion functions"
      exports: ["celsiusToFahrenheit", "litersToOunces", "gramsToOunces", "hPaToInHg"]
    - path: "test/constants.test.js"
      provides: "Freeze validation and structure tests for all 5 constant arrays"
    - path: "test/converters.test.js"
      provides: "Table-driven tests for all 4 converter functions"
  key_links:
    - from: "constants.js"
      to: "none"
      via: "standalone module, no imports"
      pattern: "Object\\.freeze"
    - from: "converters.js"
      to: "none"
      via: "standalone module, no imports"
      pattern: "export const (celsiusToFahrenheit|litersToOunces|gramsToOunces|hPaToInHg)"
---

<objective>
Extract constants and unit converters from egg-calculator.jsx into standalone modules.

Purpose: Create the foundation modules (constants.js, converters.js) that have zero dependencies, enabling formatters.js extraction in Plan 02. These are the leaf nodes in the dependency graph.
Output: Two new modules with named exports, plus comprehensive tests for both.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-utilities-extraction/03-RESEARCH.md
@physics.js
@egg-calculator.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create constants.js and converters.js modules</name>
  <files>constants.js, converters.js</files>
  <action>
  Create `constants.js` in the project root (same level as physics.js). Extract the 5 constant arrays from egg-calculator.jsx lines 272-306. Use CONSTANT_CASE naming with named exports. Apply Object.freeze() to both the outer arrays AND each inner object (shallow freeze at two levels). Copy the exact data values from the component — do NOT modify any property names, values, or structure.

  The 5 exports:
  - `STOVE_TYPES` (from `stoveTypes`, lines 272-278): 5 objects with {id, nameKey, efficiency, defaultPower, icon}
  - `POT_MATERIALS` (from `potMaterials`, lines 280-286): 5 objects with {id, nameKey, heatCapacity}
  - `CONSISTENCY_OPTIONS` (from `consistencyOptions`, lines 288-293): 4 objects with {id, nameKey, temp, color}
  - `EGG_SIZES` (from `eggSizes`, lines 295-300): 4 objects with {name, weight}
  - `START_TEMP_OPTIONS` (from `startTempOptions`, lines 302-306): 3 objects with {nameKey, temp, icon}

  Create `converters.js` in the project root. Extract the 4 unit conversion formulas currently embedded inline in egg-calculator.jsx format functions (lines 563-593). Each converter is a pure function: number in, number out.

  The 4 exports:
  - `celsiusToFahrenheit(tempC)` — `Math.round(tempC * 9 / 5 + 32)` (from line 565)
  - `litersToOunces(volumeL)` — `Math.round(volumeL * 33.814 * 10) / 10` (from line 573)
  - `gramsToOunces(weightG)` — `Math.round(weightG / 28.35 * 10) / 10` (from line 581)
  - `hPaToInHg(pressureHPa)` — `Math.round(pressureHPa * 0.02953 * 100) / 100` (from line 589)

  Both files must have zero imports — they are leaf modules with no dependencies.
  </action>
  <verify>
  Run `node -e "const c = require('./constants.js')" 2>&1 || node --input-type=module -e "import * as c from './constants.js'; console.log(Object.keys(c).length === 5 ? 'OK: 5 exports' : 'FAIL')"` to confirm 5 exports.
  Run `node --input-type=module -e "import { celsiusToFahrenheit } from './converters.js'; console.log(celsiusToFahrenheit(100) === 212 ? 'OK' : 'FAIL')"` to confirm converter works.
  </verify>
  <done>constants.js exports 5 frozen arrays with exact data from component. converters.js exports 4 pure conversion functions with identical math to inline component code.</done>
</task>

<task type="auto">
  <name>Task 2: Write tests for constants and converters</name>
  <files>test/constants.test.js, test/converters.test.js</files>
  <action>
  Create `test/constants.test.js` following the pattern from test/physics.test.js. Test two concerns:

  1. **Freeze validation** — verify each of the 5 exported arrays is frozen AND each element within is frozen:
     ```
     expect(Object.isFrozen(STOVE_TYPES)).toBe(true)
     STOVE_TYPES.forEach(item => expect(Object.isFrozen(item)).toBe(true))
     ```
     Repeat for all 5 constants.

  2. **Structure validation** — verify each constant array has expected properties and reasonable values:
     - STOVE_TYPES: 5 items, each has id, nameKey, efficiency (0 < eff <= 1), defaultPower (> 0), icon
     - POT_MATERIALS: 5 items, each has id, nameKey, heatCapacity (> 0)
     - CONSISTENCY_OPTIONS: 4 items, each has id, nameKey, temp (> 0), color (starts with #)
     - EGG_SIZES: 4 items, each has name, weight (> 0), weights ascending (S < M < L < XL)
     - START_TEMP_OPTIONS: 3 items, each has nameKey, temp, icon

  Create `test/converters.test.js` using it.each() table-driven tests (proven pattern from Phase 2):

  1. **celsiusToFahrenheit**: Test with [0, 32], [100, 212], [37, 99], [-40, -40], [20, 68]
  2. **litersToOunces**: Test with [1.0, 33.8], [1.5, 50.7], [0.5, 16.9], [0, 0]
  3. **gramsToOunces**: Test with [28.35, 1.0], [60, 2.1], [0, 0]
  4. **hPaToInHg**: Test with [1013.25, 29.92], [900, 26.58], [0, 0]

  Use exact toBe() for integer results and toBeCloseTo(expected, 1) for decimal results.
  </action>
  <verify>Run `npx vitest run test/constants.test.js test/converters.test.js` — all tests pass.</verify>
  <done>constants.test.js validates freeze state and structure for all 5 arrays. converters.test.js validates all 4 conversion functions with known-good values using table-driven tests. All tests pass.</done>
</task>

</tasks>

<verification>
1. `npx vitest run test/constants.test.js test/converters.test.js` — all tests pass
2. `node --input-type=module -e "import * as c from './constants.js'; console.log(Object.keys(c))"` — shows 5 exports
3. `node --input-type=module -e "import * as c from './converters.js'; console.log(Object.keys(c))"` — shows 4 exports
4. `npx vitest run` — ALL existing tests still pass (physics + smoke test)
</verification>

<success_criteria>
- constants.js exports 5 frozen constant arrays matching exact component data
- converters.js exports 4 pure conversion functions matching exact component math
- Both modules have zero imports (standalone leaf modules)
- All new tests pass
- All existing tests still pass (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/03-utilities-extraction/03-01-SUMMARY.md`
</output>
