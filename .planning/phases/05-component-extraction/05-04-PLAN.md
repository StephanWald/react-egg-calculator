---
phase: 05-component-extraction
plan: 04
type: execute
wave: 2
depends_on: [05-02, 05-03]
files_modified:
  - egg-calculator.jsx
autonomous: true

must_haves:
  truths:
    - "EggCalculator imports and renders all 7 extracted components"
    - "EggCalculator is under 400 lines"
    - "Application renders identically to before extraction (visual parity)"
    - "All 194+ existing tests still pass"
    - "Production build succeeds without errors"
  artifacts:
    - path: "egg-calculator.jsx"
      provides: "Main smart component orchestrating all child components"
      min_lines: 200
  key_links:
    - from: "egg-calculator.jsx"
      to: "components/ConfigDialog.jsx"
      via: "import + JSX render"
      pattern: "import.*ConfigDialog.*from.*components"
    - from: "egg-calculator.jsx"
      to: "components/TimerOverlay.jsx"
      via: "import + JSX render"
      pattern: "import.*TimerOverlay.*from.*components"
    - from: "egg-calculator.jsx"
      to: "components/ConsistencyPicker.jsx"
      via: "import + JSX render"
      pattern: "import.*ConsistencyPicker.*from.*components"
    - from: "egg-calculator.jsx"
      to: "components/SettingsPanel.jsx"
      via: "import + JSX render"
      pattern: "import.*SettingsPanel.*from.*components"
    - from: "egg-calculator.jsx"
      to: "components/LocationPressure.jsx"
      via: "import + JSX render"
      pattern: "import.*LocationPressure.*from.*components"
    - from: "egg-calculator.jsx"
      to: "components/EggInputs.jsx"
      via: "import + JSX render"
      pattern: "import.*EggInputs.*from.*components"
    - from: "egg-calculator.jsx"
      to: "components/ResultDisplay.jsx"
      via: "import + JSX render"
      pattern: "import.*ResultDisplay.*from.*components"
---

<objective>
Rewire egg-calculator.jsx to use all 7 extracted components, reducing it to under 400 lines.

Purpose: This is the integration step. The main EggCalculator becomes a smart component that holds all hooks, state, effects, and handlers, and delegates rendering to the 7 extracted presentational components. The app must render and behave identically after rewiring.
Output: Updated egg-calculator.jsx under 400 lines, importing and rendering all 7 components.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-component-extraction/05-02-SUMMARY.md
@.planning/phases/05-component-extraction/05-03-SUMMARY.md
@egg-calculator.jsx
@components/ConfigDialog.jsx
@components/TimerOverlay.jsx
@components/ConsistencyPicker.jsx
@components/SettingsPanel.jsx
@components/LocationPressure.jsx
@components/EggInputs.jsx
@components/ResultDisplay.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewire EggCalculator to use extracted components</name>
  <files>egg-calculator.jsx</files>
  <action>
**PREREQUISITE: Verify all 7 component files exist before proceeding.**
Run `ls components/ConfigDialog.jsx components/TimerOverlay.jsx components/ConsistencyPicker.jsx components/SettingsPanel.jsx components/LocationPressure.jsx components/EggInputs.jsx components/ResultDisplay.jsx` and confirm all 7 files exist with named exports. If any file is missing, STOP and report which files are missing -- do not proceed with partial rewiring.

**After verification succeeds**, replace all inline JSX in egg-calculator.jsx with the 7 extracted component imports. The component keeps:

**KEEP in egg-calculator.jsx (logic section):**
- All imports (add new component imports)
- All hook calls (useTranslation, useSettings, useUnitConversion, useTimerLogic, useLocationPressure)
- All state declarations (cookingTime, tempDrop, etc., showSettings, showAdvanced, etc.)
- All useEffect hooks (location sync, escape key, calculation trigger)
- All handler functions (handleStoveTypeChange, handleConsistencyChange, handleStartTimer, etc.)
- getPotHeatCapacity helper
- getLocationErrorMessage helper

**REMOVE from egg-calculator.jsx (replace with component tags):**

Find each section by its JSX comment marker (content-based, not line numbers):
- `getEggVisualization` function -> delete (moved to ResultDisplay)
- `{/* ============ CONFIG DIALOG ============ */}` section -> `<ConfigDialog ... />`
- `{/* ============ TIMER OVERLAY ============ */}` section -> `<TimerOverlay ... />` (keep conditional `{(timerActive || timerComplete) && ...}` in parent)
- `{/* ============ SETTINGS PANEL ============ */}` section -> `{showSettings && <SettingsPanel ... />}`
- `{/* Result Display */}` section -> `<ResultDisplay ... />`
- `{/* Location & Pressure Section */}` section -> `<LocationPressure ... />`
- `{/* Consistency Selection */}` section -> `<ConsistencyPicker ... />`
- `{/* Egg Count & Water Volume */}` through `{/* Start Temperature */}` sections -> `<EggInputs ... />`

**ADD component imports:**
```javascript
import { ConfigDialog } from './components/ConfigDialog';
import { TimerOverlay } from './components/TimerOverlay';
import { ConsistencyPicker } from './components/ConsistencyPicker';
import { SettingsPanel } from './components/SettingsPanel';
import { LocationPressure } from './components/LocationPressure';
import { EggInputs } from './components/EggInputs';
import { ResultDisplay } from './components/ResultDisplay';
```

**REMOVE unused imports from egg-calculator.jsx:**
After removing inline JSX, some imports from constants.js and formatters.js may no longer be needed in the main component. Check which constants and formatters are still used directly in the remaining JSX (Header, settings toggle button, notices, energy section, formulas section, footer). Remove any that are only used in extracted components.

Keep: `formatTemp` (used in settings toggle summary), `formatTime` (if used), `formatCountdown` (if used), `STOVE_TYPES` (used in settings toggle and energy section), `formatVolume` (if used in energy), `formatPressure` (if used).

**Wire props for each component:**

ConfigDialog:
```jsx
<ConfigDialog
  visible={showConfigDialog}
  onClose={() => setShowConfigDialog(false)}
  tempUnit={tempUnit}
  volumeUnit={volumeUnit}
  weightUnit={weightUnit}
  pressureUnit={pressureUnit}
  onTempUnitChange={handleTempUnitChange}
  onVolumeUnitChange={handleVolumeUnitChange}
  onWeightUnitChange={handleWeightUnitChange}
  onPressureUnitChange={handlePressureUnitChange}
  languages={languages}
  currentLanguage={lang}
  onLanguageChange={setLanguage}
/>
```

TimerOverlay (conditional rendering stays in parent):
```jsx
{(timerActive || timerComplete) && (
  <TimerOverlay
    timerActive={timerActive}
    timerComplete={timerComplete}
    timerPaused={timerPaused}
    timerRemaining={timerRemaining}
    onPause={pauseTimer}
    onResume={resumeTimer}
    onStop={stopTimer}
    onDismiss={dismissComplete}
  />
)}
```

SettingsPanel (conditional rendering stays in parent):
```jsx
{showSettings && (
  <SettingsPanel
    stoveType={stoveType}
    stovePower={stovePower}
    stoveEfficiency={stoveEfficiency}
    potMaterial={potMaterial}
    potWeight={potWeight}
    waterStartTemp={waterStartTemp}
    ambientTemp={ambientTemp}
    tempUnit={tempUnit}
    onStoveTypeChange={handleStoveTypeChange}
    onStovePowerChange={(val) => updateSetting('stovePower', val)}
    onPotMaterialChange={(val) => updateSetting('potMaterial', val)}
    onPotWeightChange={(val) => updateSetting('potWeight', val)}
    onWaterStartTempChange={(val) => updateSetting('waterStartTemp', val)}
    onAmbientTempChange={(val) => updateSetting('ambientTemp', val)}
    onResetToDefaults={handleResetToDefaults}
  />
)}
```

ResultDisplay:
```jsx
<ResultDisplay
  cookingTime={cookingTime}
  idealTime={idealTime}
  tempDrop={tempDrop}
  effectiveTemp={effectiveTemp}
  consistency={consistency}
  tempUnit={tempUnit}
  timerActive={timerActive}
  timerRemaining={timerRemaining}
  onStartTimer={handleStartTimer}
  onStopTimer={handleStopTimer}
/>
```

LocationPressure:
```jsx
<LocationPressure
  pressure={pressure}
  boilingPoint={boilingPoint}
  altitude={altitude}
  locationName={locationName}
  locationLoading={locationLoading}
  locationError={locationError}
  pressureSource={pressureSource}
  tempUnit={tempUnit}
  pressureUnit={pressureUnit}
  onGetLocation={getLocationAndPressure}
  onPressureChange={handleManualPressure}
  locationErrorMessage={getLocationErrorMessage(locationError)}
/>
```

ConsistencyPicker:
```jsx
<ConsistencyPicker
  consistency={consistency}
  tempUnit={tempUnit}
  onConsistencyChange={handleConsistencyChange}
/>
```

EggInputs:
```jsx
<EggInputs
  eggCount={eggCount}
  waterVolume={waterVolume}
  weight={weight}
  startTemp={startTemp}
  tempUnit={tempUnit}
  volumeUnit={volumeUnit}
  weightUnit={weightUnit}
  onEggCountChange={(val) => updateSetting('eggCount', val)}
  onWaterVolumeChange={(val) => updateSetting('waterVolume', val)}
  onWeightChange={(val) => updateSetting('weight', val)}
  onStartTempChange={(val) => updateSetting('startTemp', val)}
/>
```

**KEEP inline in egg-calculator.jsx (not worth extracting):**
- Header section (title + config button, ~15 lines)
- Settings toggle button (~15 lines)
- Important notices (~18 lines)
- Energy section toggle + content (~35 lines)
- Formula section toggle + content (~35 lines)
- Footer (~5 lines)

These small sections stay inline because they're minimal, tightly coupled to local state (showEnergy, showAdvanced, showSettings, showConfigDialog), and extracting them would add file overhead without benefit.
  </action>
  <verify>
1. `wc -l egg-calculator.jsx` -- must be under 400 lines
2. `npm test` -- all existing tests pass (194+)
3. `npm run build` -- production build succeeds
4. `npm run dev` -- visual parity confirmed (app renders identically)
  </verify>
  <done>EggCalculator under 400 lines. All 7 components imported and rendered with correct props. All existing tests pass. Build succeeds. App looks and behaves identically.</done>
</task>

</tasks>

<verification>
- `wc -l egg-calculator.jsx` shows under 400 lines
- `npm test` passes all 194+ existing tests
- `npm run build` succeeds without errors or warnings
- Dev server shows identical UI to pre-extraction state
- All interactive features work: settings panel toggle, config dialog open/close, timer start/stop/pause, GPS detect, consistency selection, all inputs
</verification>

<success_criteria>
- EggCalculator component is under 400 lines (REFAC-03 requirement)
- All 7 components (ConfigDialog, TimerOverlay, ConsistencyPicker, SettingsPanel, LocationPressure, EggInputs, ResultDisplay) imported and rendered
- Zero visual or behavioral differences from pre-extraction state
- All existing tests pass
- Production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/05-component-extraction/05-04-SUMMARY.md`
</output>
